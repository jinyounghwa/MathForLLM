# PRD: LLM 수학 학습 웹서비스

## 1. 프로젝트 개요

### 1.1 프로젝트명
**MathForLLM** (가칭)

### 1.2 목적
LLM/AI 개발을 위한 수학 기초를 효과적으로 학습할 수 있는 웹 기반 대화형 학습 서비스

### 1.3 타겟 사용자
- LLM/AI 개발에 입문하려는 개발자
- 수학 기초가 부족한 AI 엔지니어 지망생
- 독학으로 AI 수학을 공부하는 학습자

### 1.4 핵심 가치
- 로컬 LLM(Qwen 2.5 7B) 기반 비용 제로 운영
- 기존 학습 자료(MD 파일)를 RAG로 활용한 정확한 답변
- 역할극 기반 맥락 학습으로 이해도 향상

---

## 2. 기능 요구사항

### 2.1 학습 모드 선택

#### 2.1.1 일반 질문 모드
**설명**: 사용자가 자유롭게 질문하고 즉시 답변 받는 모드

**주요 기능**:
- 채팅 인터페이스를 통한 자유 질문
- RAG 기반 교재 내용 참조 답변
- 질문 히스토리 저장 (LocalStorage)

**플로우**:
```
사용자 질문 입력
  ↓
벡터 검색으로 관련 교재 내용 검색
  ↓
Qwen 2.5 7B + 검색된 내용으로 답변 생성
  ↓
답변 표시 (출처 교재 섹션 표시)
```

#### 2.1.2 계획된 학습 모드
**설명**: 체계적인 커리큘럼 기반 학습 경로 제공

**설정 항목**:
- **학습 주기**: 1일/2일/3일/7일 중 선택
- **학습 시간**: 30분/1시간/2시간 중 선택

**주요 기능**:
- 학습 일정 자동 생성 (시작일 기준)
- 일차별 학습 내용 자동 할당
- 학습 진도 추적 및 시각화
- 복습 알림 (브라우저 알림)

**학습 내용 구성** (예시):
```
Day 1 (1시간): 확률 기초 - 확률의 정의와 기본 법칙
Day 3 (1시간): 확률 분포 - 이산/연속 확률 분포
Day 5 (1시간): 베이즈 정리 - 조건부 확률과 베이즈 추론
...
```

**플로우**:
```
학습 설정 완료
  ↓
커리큘럼 자동 생성 (총 일수, 학습 내용 할당)
  ↓
학습일 선택 → 해당일 학습 내용 표시
  ↓
채팅으로 질문하며 학습
  ↓
학습 완료 체크 → 다음 학습일 안내
```

---

### 2.2 답변 모드 선택

#### 2.2.1 일반 모드
**설명**: 직관적이고 간결한 설명 방식

**특징**:
- 개념 정의
- 수식 설명
- 예제 코드/계산
- 관련 개념 연결

**예시**:
```
Q: 엔트로피란 무엇인가요?

A: 엔트로피(Entropy)는 정보 이론에서 불확실성의 척도입니다.

수식: H(X) = -Σ p(x) log p(x)

의미:
- 확률 분포가 균등할수록 엔트로피가 높음
- 확실한 사건은 엔트로피가 0
- LLM에서는 다음 토큰 예측의 불확실성을 측정하는 데 사용

[참고: 정보이론.md > 엔트로피 섹션]
```

#### 2.2.2 역할극 모드
**설명**: 실제 상황에 빗대어 맥락적으로 설명하는 방식

**구성 요소**:
- **상황 설정**: 실무/연구 상황 시뮬레이션
- **역할 부여**: 학습자의 역할 명시
- **문제 제시**: 해결해야 할 과제
- **개념 연결**: 왜 이 수학이 필요한지 설명

**예시**:
```
Q: 엔트로피란 무엇인가요?

A: 【역할극 시작】

상황: 당신은 AI 스타트업에서 챗봇 모델을 개발하는 주니어 엔지니어입니다.

팀장: "이번 모델의 출력이 너무 확신에 차 있어서 문제야. 
       엔트로피를 측정해서 불확실할 때는 '잘 모르겠습니다'라고 
       답하게 만들 수 있을까?"

당신의 미션: 엔트로피를 이해하고 구현하기

---

엔트로피란?
- 모델이 얼마나 "헷갈려하는지" 측정하는 지표
- 수식: H(X) = -Σ p(x) log p(x)

실전 예시:
다음 토큰 예측 확률이
- [0.9, 0.05, 0.05]: 엔트로피 낮음 → 확신함
- [0.4, 0.3, 0.3]: 엔트로피 높음 → 헷갈림

팀장의 요구사항을 해결하려면:
엔트로피가 임계값 이상이면 "잘 모르겠습니다" 출력

[참고: 정보이론.md > 엔트로피 섹션]
```

---

## 3. 기술 스택

### 3.1 프론트엔드
- **Framework**: Next.js 16 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **UI Components**: shadcn/ui (채팅 인터페이스)
- **State Management**: React Context API
- **Storage**: LocalStorage (학습 진도, 히스토리)

### 3.2 백엔드 (경량화)
- **Framework**: Bun + Hono (경량 웹 프레임워크)
- **Language**: TypeScript
- **Vector Search**: **vectra** (메모리 기반 경량 벡터 검색 라이브러리)
  - ChromaDB/LanceDB보다 훨씬 가벼움
  - 별도 서버 불필요, Node.js 환경에서 직접 동작
  - 로컬 JSON 파일 기반 저장
- **Embedding**: Qwen 2.5 7B의 embedding 기능 또는 simple cosine similarity
- **LLM Server**: Ollama (localhost:11434)

**선택 이유**:
- Bun: Node.js보다 빠르고 가벼움
- Hono: Express보다 경량, 타입 안전
- vectra: 가장 경량, 설치/설정 간단, 로컬 파일 기반
- Ollama: 이미 실행 중

### 3.3 배포
- **프론트엔드**: Vercel
- **백엔드**: 로컬 실행 가이드 제공
- **데모**: 사전 녹화 시나리오 또는 로컬 환경 영상

---

## 4. 시스템 아키텍처

```
┌─────────────────────────────────────────┐
│         Frontend (Next.js 16)           │
│  ┌─────────────────────────────────┐   │
│  │   채팅 인터페이스 (shadcn/ui)   │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │   학습 모드 선택 UI             │   │
│  │   - 일반 질문                   │   │
│  │   - 계획된 학습                 │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │   답변 모드 토글                │   │
│  │   - 일반 모드                   │   │
│  │   - 역할극 모드                 │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
                  ↓ HTTP
┌─────────────────────────────────────────┐
│      Backend (Bun + Hono)               │
│  ┌─────────────────────────────────┐   │
│  │   API Routes                    │   │
│  │   - /api/chat                   │   │
│  │   - /api/curriculum             │   │
│  │   - /api/search                 │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │   RAG Engine                    │   │
│  │   - vectra 벡터 검색            │   │
│  │   - 컨텍스트 조합               │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
         ↓                      ↓
┌──────────────────┐   ┌──────────────────┐
│   vectra         │   │   Ollama         │
│   (로컬 JSON)    │   │   (Qwen 2.5 7B)  │
│                  │   │   :11434         │
│   [MD 파일 벡터] │   │                  │
└──────────────────┘   └──────────────────┘
```

---

## 5. 데이터 구조

### 5.1 벡터 저장 스키마
```typescript
interface DocumentChunk {
  id: string;
  content: string;          // MD 파일 청크 내용
  metadata: {
    source: string;         // 파일명 (예: "확률과통계.md")
    section: string;        // 섹션명 (예: "엔트로피")
    chapter: number;        // 챕터 번호
    difficulty: string;     // "basic" | "intermediate" | "advanced"
  };
  embedding: number[];      // 벡터 임베딩
}
```

### 5.2 커리큘럼 데이터
```typescript
interface Curriculum {
  id: string;
  userId: string;           // 사용자 식별자 (LocalStorage)
  frequency: 1 | 2 | 3 | 7; // 학습 주기 (일)
  duration: 30 | 60 | 120;  // 학습 시간 (분)
  startDate: Date;
  schedule: LearningDay[];
}

interface LearningDay {
  day: number;              // N일차
  date: Date;
  topic: string;            // 학습 주제
  sections: string[];       // 학습할 섹션 목록
  estimatedTime: number;    // 예상 소요 시간
  completed: boolean;
}
```

### 5.3 채팅 히스토리
```typescript
interface ChatMessage {
  id: string;
  role: "user" | "assistant";
  content: string;
  mode: "normal" | "roleplay";
  sources?: string[];       // 참조한 교재 섹션
  timestamp: Date;
}

interface ChatSession {
  id: string;
  mode: "free" | "curriculum";
  curriculumDay?: number;   // 계획된 학습 모드인 경우
  messages: ChatMessage[];
  createdAt: Date;
}
```

---

## 6. API 명세

### 6.1 채팅 API
```
POST /api/chat

Request:
{
  "message": "엔트로피란 무엇인가요?",
  "mode": "roleplay",           // "normal" | "roleplay"
  "learningMode": "free",       // "free" | "curriculum"
  "curriculumDay": null,        // 계획된 학습인 경우 day number
  "history": [...]              // 이전 대화 내역
}

Response:
{
  "answer": "...",
  "sources": [
    {
      "file": "정보이론.md",
      "section": "엔트로피",
      "relevance": 0.95
    }
  ],
  "suggestedQuestions": [
    "크로스 엔트로피와 어떻게 다른가요?",
    "LLM 학습에서 엔트로피가 어떻게 사용되나요?"
  ]
}
```

### 6.2 커리큘럼 생성 API
```
POST /api/curriculum

Request:
{
  "frequency": 2,           // 2일에 한 번
  "duration": 60,           // 1시간
  "startDate": "2024-12-19"
}

Response:
{
  "curriculumId": "curr_123",
  "totalDays": 30,
  "schedule": [
    {
      "day": 1,
      "date": "2024-12-19",
      "topic": "확률 기초",
      "sections": ["확률의 정의", "조건부 확률"],
      "estimatedTime": 60
    },
    ...
  ]
}
```

### 6.3 학습 진도 조회 API
```
GET /api/curriculum/:curriculumId

Response:
{
  "curriculum": {...},
  "progress": {
    "completedDays": 5,
    "totalDays": 30,
    "currentDay": 6,
    "nextLearningDate": "2024-12-25"
  }
}
```

---

## 7. UI/UX 설계

### 7.1 메인 화면
```
┌─────────────────────────────────────────┐
│  MathForLLM 📊                    [설정]│
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  학습 모드 선택                  │   │
│  │  ○ 일반 질문 모드               │   │
│  │  ○ 계획된 학습 모드             │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  답변 모드                       │   │
│  │  [일반] [역할극] ← 토글         │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

### 7.2 일반 질문 모드 화면
```
┌─────────────────────────────────────────┐
│  ← 뒤로    일반 질문 모드    [일반모드] │
├─────────────────────────────────────────┤
│                                         │
│  [Assistant] 안녕하세요! LLM 수학에    │
│              대해 무엇이든 물어보세요.  │
│              📚 참고: 저장된 교재 5개   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 질문 입력...                    │🎤│
│  └─────────────────────────────────┘   │
│                                         │
│  💡 추천 질문:                          │
│  • 엔트로피와 크로스 엔트로피의 차이?   │
│  • softmax 함수는 왜 사용하나요?        │
└─────────────────────────────────────────┘
```

### 7.3 계획된 학습 모드 - 설정 화면
```
┌─────────────────────────────────────────┐
│  ← 뒤로    학습 계획 설정               │
├─────────────────────────────────────────┤
│                                         │
│  📅 학습 주기                           │
│  ○ 매일  ● 2일마다  ○ 3일마다  ○ 주1회 │
│                                         │
│  ⏱️ 학습 시간                           │
│  ○ 30분  ● 1시간  ○ 2시간              │
│                                         │
│  📆 시작일                              │
│  [2024-12-19] 선택                      │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  예상 일정:                      │   │
│  │  • 총 30일 과정                  │   │
│  │  • 학습일 15일                   │   │
│  │  • 완료 예정: 2025-01-18         │   │
│  └─────────────────────────────────┘   │
│                                         │
│         [학습 계획 생성하기]            │
└─────────────────────────────────────────┘
```

### 7.4 계획된 학습 모드 - 학습 화면
```
┌─────────────────────────────────────────┐
│  ← 뒤로    Day 3 학습    [역할극모드]   │
├─────────────────────────────────────────┤
│  📍 확률 분포 (예상 1시간)              │
│  진행률: ████████░░ 80%                 │
├─────────────────────────────────────────┤
│                                         │
│  [Assistant] 【역할극 시작】            │
│              당신은 AI 연구팀의...      │
│              (역할극 설명)              │
│                                         │
│  [User] 이산 확률 분포란?               │
│                                         │
│  [Assistant] 좋은 질문입니다!           │
│              상황: 당신은...            │
│              (맥락과 함께 설명)         │
│              📚 참고: 확률과통계.md     │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 질문 입력...                    │🎤│
│  └─────────────────────────────────┘   │
│                                         │
│  [이전 학습] [다음 학습] [학습 완료]    │
└─────────────────────────────────────────┘
```

---

## 8. RAG 시스템 상세 설계

### 8.1 문서 전처리 파이프라인
```
MD 파일 로드
  ↓
헤딩 기준 섹션 분할
  ↓
각 섹션을 청크로 분할 (512 토큰)
  ↓
메타데이터 추출 (제목, 챕터, 난이도)
  ↓
간단한 임베딩 생성 (TF-IDF 또는 Qwen)
  ↓
vectra에 저장 (로컬 JSON)
```

### 8.2 검색 전략
**Hybrid Search**:
1. **벡터 검색** (70% 가중치): 의미적 유사도
2. **키워드 검색** (30% 가중치): 정확한 용어 매칭

**Re-ranking**:
- 학습 모드에 따라 우선순위 조정
  - 계획된 학습: 해당일 섹션 우선
  - 일반 질문: 전체 검색

### 8.3 컨텍스트 조합
```typescript
function buildContext(query: string, mode: LearningMode) {
  // 1. 관련 문서 검색 (top 3)
  const docs = await vectraIndex.search(query, { topK: 3 });
  
  // 2. 시스템 프롬프트 구성
  const systemPrompt = mode === "roleplay" 
    ? ROLEPLAY_SYSTEM_PROMPT 
    : NORMAL_SYSTEM_PROMPT;
  
  // 3. 검색된 문서 내용 추가
  const context = docs.map(doc => 
    `[출처: ${doc.metadata.source}]\n${doc.content}`
  ).join("\n\n");
  
  // 4. 최종 프롬프트
  return {
    system: systemPrompt,
    context: context,
    query: query
  };
}
```

---

## 9. 프롬프트 엔지니어링

### 9.1 일반 모드 시스템 프롬프트
```
당신은 LLM/AI 수학을 가르치는 전문 강사입니다.

역할:
- 수학 개념을 명확하고 간결하게 설명
- 실제 LLM 구현에서 어떻게 사용되는지 연결
- 수식과 함께 직관적인 설명 제공

답변 형식:
1. 개념 정의 (1-2문장)
2. 수식 (LaTeX 또는 간단한 표기)
3. LLM과의 연관성
4. 간단한 예제

참고 자료:
{context}

제약사항:
- 답변은 300자 이내로 간결하게
- 수학 용어는 한글과 영어 병기
- 참고 자료 출처 명시
```

### 9.2 역할극 모드 시스템 프롬프트
```
당신은 LLM 개발 시뮬레이션을 진행하는 멘토입니다.

역할:
- 실제 업무 상황을 설정하여 몰입도 증가
- 왜 이 수학이 필요한지 맥락 제공
- 학습자가 문제를 해결하는 주인공

답변 형식:
【역할극 시작】

상황: (실무/연구 상황 설정)
당신의 역할: (학습자 역할)
미션: (해결해야 할 과제)

---

(개념 설명 - 상황과 연결)

실전 적용:
(구체적 예시)

다음 단계:
(추가 학습 제안)

【역할극 종료】

📚 참고: (출처)

참고 자료:
{context}

제약사항:
- 상황은 현실적이고 공감 가능하게
- 전문 용어는 상황 속에서 자연스럽게 소개
- 학습자의 성취감을 높이는 톤
```

---

## 10. 개발 일정 (2일)

### Day 1: 코어 기능 구현
**오전 (4시간)**
- [ ] Next.js 16 프로젝트 세팅 + Tailwind
- [ ] shadcn/ui 채팅 컴포넌트 설치
- [ ] 기본 UI 레이아웃 (모드 선택, 채팅창)

**오후 (4시간)**
- [ ] Bun + Hono 백엔드 세팅
- [ ] vectra 설치 및 테스트
- [ ] MD 파일 → 벡터 임베딩 스크립트
- [ ] /api/chat 엔드포인트 구현

**저녁 (2시간)**
- [ ] Ollama 연동 테스트
- [ ] RAG 검색 로직 구현
- [ ] 일반 질문 모드 동작 확인

### Day 2: 완성도 및 배포
**오전 (4시간)**
- [ ] 계획된 학습 모드 UI
- [ ] 커리큘럼 생성 로직
- [ ] 학습 진도 표시

**오후 (3시간)**
- [ ] 역할극 모드 프롬프트 적용
- [ ] LocalStorage 연동
- [ ] 답변 모드 토글 기능

**저녁 (3시간)**
- [ ] README 작성 (아키텍처, 실행 방법)
- [ ] 데모 시나리오 작성 및 녹화
- [ ] 정리 및 배포 준비

---

## 11. 성공 지표

### 11.1 기술적 목표
- [ ] RAG 검색 정확도 80% 이상
- [ ] 답변 생성 속도 3초 이내
- [ ] 로컬 환경에서 안정적 동작
- [ ] 메모리 사용량 2GB 이하

---

## 12. 향후 확장 가능성

### Phase 2 (1주일)
- [ ] 학습 통계 대시보드
- [ ] 퀴즈 자동 생성 기능
- [ ] 음성 입력/출력
- [ ] 다크 모드

### Phase 3 (2주일)
- [ ] 멀티 유저 지원
- [ ] 학습 그룹 / 스터디
- [ ] 교재 추가 (선형대수, 미적분 등)

---

## 13. 리스크 및 대응

| 리스크 | 영향 | 대응 방안 |
|--------|------|-----------|
| Qwen 2.5 7B 답변 품질 부족 | 높음 | 프롬프트 튜닝, 더 큰 모델 고려 |
| 벡터 검색 정확도 낮음 | 중간 | 키워드 검색 병행, Re-ranking |
| 2일 내 완성 실패 | 중간 | 핵심 기능 우선, 나머지는 Phase 2 |
| vectra 성능 이슈 | 낮음 | 문서 수가 적으면 문제 없음 |

---

## 14. 참고 자료

### 14.1 기술 문서
- [Ollama API Docs](https://github.com/ollama/ollama/blob/main/docs/api.md)
- [vectra NPM Package](https://www.npmjs.com/package/vectra)
- [Hono Web Framework](https://hono.dev/)
- [Next.js 16 Documentation](https://nextjs.org/docs)

### 14.2 유사 프로젝트
- Cursor (AI IDE with RAG)
- Perplexity (RAG-based search)
- Khan Academy (adaptive learning)

---

## 부록: 프로젝트 구조

```
math-for-llm/
├── frontend/
│   ├── app/
│   │   ├── page.tsx              # 메인 페이지
│   │   ├── chat/
│   │   │   └── page.tsx          # 채팅 화면
│   │   └── curriculum/
│   │       └── page.tsx          # 학습 계획 화면
│   ├── components/
│   │   ├── ChatInterface.tsx
│   │   ├── ModeSelector.tsx
│   │   └── CurriculumSetup.tsx
│   ├── lib/
│   │   ├── api.ts                # API 클라이언트
│   │   └── storage.ts            # LocalStorage 유틸
│   └── package.json
│
├── backend/
│   ├── src/
│   │   ├── index.ts              # Hono 서버 엔트리
│   │   ├── routes/
│   │   │   ├── chat.ts
│   │   │   ├── curriculum.ts
│   │   │   └── search.ts
│   │   ├── services/
│   │   │   ├── rag.ts            # RAG 로직 (vectra 사용)
│   │   │   ├── llm.ts            # Ollama 연동
│   │   │   └── vectordb.ts       # vectra 연동
│   │   └── utils/
│   │       ├── prompts.ts        # 프롬프트 템플릿
│   │       └── curriculum-generator.ts
│   ├── scripts/
│   │   └── ingest-docs.ts        # MD → 벡터 변환
│   ├── data/
│   │   └── vectors/              # vectra 인덱스 저장 (JSON)
│   └── package.json
│
├── docs/                          # 학습 교재 (MD 파일)
│   ├── 01-확률과통계.md
│   ├── 02-선형대수.md
│   ├── 03-정보이론.md
│   └── ...
│
└── README.md
```

---

**작성일**: 2024-12-18  
**작성자**: 진영화  
**버전**: 1.1
